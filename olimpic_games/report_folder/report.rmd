---
title: "report"
author: "Pavel Vychyk"
date: "11/7/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
#### Check for required packages
```{r perform packages installation, message=FALSE, results='hide', warn.conflicts=F}
pckages <- c('data.table', 'tidyr', 'dplyr', 'ggplot2', 'nortest', 'knitr')
for(package in pckages) {
  if(!require(package, character.only = T)) {
    install.packages(package, dependencies = T)
    library(package)
  }
}
```
#### Load required libraries 
```{r message=FALSE}
library(data.table)
library(tidyr)
library(dplyr)
library(ggplot2)
library(nortest)
library(knitr)
```

#### provide the path to the data
```{r}
input_folder <- "/home/aither/institute-for-bioinformatics/r-studio/project-olympics/athlete_events/"
extension = "csv"
```

#### 1. Import function
``` {r input_folder extension, echo = T, results = 'hide', warning = FALSE}
data_import <- function(input_folder, extension){
  files <- list.files(paste(input_folder), full.names = T, pattern = paste0(".+",extension,"$"))
  print(files)
  rbindlist(lapply(files, fread), fill = T)
}

olympics_data <- data_import(input_folder, "csv")
```


#### 2. correct data - some rows have incomplete entries, due to fread import - correct with NA?
Some variable have anomalities, and NA values. Further we proceed with filtering
values in functions via !is.na() etc.
```{r}
apply(olympics_data[, 3], 2, FUN = unique)
```

#### 3. get youngest athletes on Olympics 1992
```{r}
olympics_data[olympics_data$Year == 1992, .SD[which.min(Age)], by = Sex]
```

#### 4. Calculate mean and standard deviation for Height in each Sex category
```{r} 
olympics_data %>% 
  filter(!is.na(Height) & Sex %in% c("M","F")) %>%
  group_by(Sex) %>% 
  summarize(mean(Height), sd(Height))
```

#### 5. Calculate mean and standard deviation for female tennis players on Olympics 2020
``` {r}
olympics_data %>% 
  filter(!is.na(Height) & Sex == "F" & Year == 2006) %>%
  summarize(mean(Height), sd(Height))
```

#### 6. The most heavy athlete sports
```{r}
olympics_data %>% 
  filter(!is.na(Weight) & Year == 2006 & Sex == "M") %>%
  filter(Weight == max(Weight)) %>% select(Name,Weight,Sport)
```

#### 7. Woman's gold count from 1980 to 2010
```{r} 
olympics_data %>% 
  filter( Sex == "F" & Year >= 1980 & Year <= 2010 & Medal == "Gold") %>%
  summarise(n = n())
```

#### 8. John Aalberg participation in Olympics
```{r}
olympics_data %>% 
  filter( Name == "John Aalberg") %>% group_by(Year) %>% 
  summarise(n = n())
```

#### 9. Age groups of athletes on Olympics 2008
```{r}
A2008 <- olympics_data %>% 
  filter( Year == 2008 & !is.na(Age)) %>% select(Age)
ggplot(data=A2008, aes(x=A2008$Age)) +
  geom_histogram(binwidth=5,
                 aes(col=I("white")), 
                 closed = "right", 
                 center = 2.5) +
  scale_x_continuous(xlab("Age groups"), 
                     breaks=seq(15,55, by = 5))
```                     

#### 10. Sports number difference between 2002 and 1994
```{r}
diff_sports <- olympics_data %>% 
  filter(Year %in% c(1994,2002)) %>%
  group_by(Year) %>% 
  summarise(count = n_distinct(Sport))
```

#### 11. Top 3 for medals 
```{r}
olympics_data %>% 
  filter(!is.na(Medal) & !is.na(Season) & !is.na(Team)) %>% 
  group_by(Season,Medal,Team) %>% 
  summarise(n = n()) %>% 
  slice_max(order_by = n, n = 3)
```

#### 12. Calculate Height_z_scores for Height variable
```{r}
olympics_data %>% 
  filter(!is.na(Height)) %>%
  mutate(Height_z_scores = (Height - mean(Height)) / sd(Height)) %>% 
  mutate
```

#### 13. Min-max normalization
```{r}
olympics_data %>% 
  filter(!is.na(Height)) %>%
  mutate(Height_min_max_scaled = (Height - min(Height))/(max(Height)+min(Height))) %>% 
  mutate(Height_min_max_scaled = round(Height_min_max_scaled,2)) %>% 
  head()
```

#### 14. Comparison of height for men and women participated in 
#### winter Olympics
Firstly, we must check our data for normality. I've used to Shapiro-Wilk and 
Anderson-Darling normality tests. Although the Q-Q Plots were used to provide
additional support to the tests evidences.
```{r}
w_men_height <- olympics_data %>% 
  filter(!is.na(Height) & is.numeric(Height) & Sex == "M" & Season == "Winter") %>% 
  select(Height)
w_women_height <- olympics_data %>% 
  filter(!is.na(Height) & Sex == "F" & Season == "Winter") %>% 
  select(Height)
 
shapiro.test(w_men_height$Height[0:3000])
ad.test(w_men_height$Height)
qqnorm(w_men_height$Height)
qqline(w_men_height$Height)

shapiro.test(w_women_height$Height[0:3000])
ad.test(w_women_height$Height)
qqnorm(w_women_height$Height)
qqline(w_women_height$Height)
```

<p>Despite statistical tests reject hypothesis for normality in our data, 
plots and provide enough information to use both parametric and non-parametric
comparison tests: Student's t-Test and Mann-Whitney test. Both support the existence of
difference in height for men in women in the sample, rejecting the Null-hypothesis<p>

```{r}
t.test(w_men_height$Height, w_women_height$Height, alternative = c("two.sided"))
wilcox.test(w_men_height$Height, w_women_height$Height, alternative = c("two.sided"), paired = F)
```

#### 15. Team and medal correlation 
To measure the association between team and medals we use
Spearman correlation coefficient for ranks.
```{r}
f_olympics_data <- olympics_data %>% 
  filter(!is.na(Team) & !is.na(Medal))

test_cor<-cor.test(rank(f_olympics_data$Team), rank(f_olympics_data$Medal), method = 'spearman')
```
The value `r test_cor$estimate` shows no association between Team and Medals.